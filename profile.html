<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A5K60 - Trang c√° nh√¢n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * { font-family: 'Inter', 'Poppins', sans-serif; }
        body { background: linear-gradient(135deg, #FAF7F0 0%, #F0EDE6 100%); min-height: 100vh; }
        .navbar { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255, 255, 255, 0.2); }
        .profile-header { background: linear-gradient(135deg, rgba(225, 112, 85, 0.1) 0%, rgba(116, 185, 255, 0.1) 100%); border-radius: 2rem; }
        .profile-avatar { width: 120px; height: 120px; background: linear-gradient(135deg, #E17055 0%, #D63031 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: white; margin: 0 auto 1rem; border: 4px solid white; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); cursor: pointer; }
        .content-section { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 1.5rem; transition: all 0.3s ease; }
        .content-section:hover { background: rgba(255, 255, 255, 0.95); transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); }
        .social-link { background: rgba(255, 255, 255, 0.8); border: 2px solid transparent; transition: all 0.3s ease; }
        .social-link:hover { background: rgba(255, 255, 255, 1); border-color: #E17055; transform: translateY(-2px); }
        .upload-btn { background: linear-gradient(135deg, #E17055 0%, #D63031 100%); transition: all 0.3s ease; }
        .upload-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(225, 112, 85, 0.3); }
        .media-item { background: rgba(255, 255, 255, 0.8); border-radius: 1rem; overflow: hidden; transition: all 0.3s ease; cursor: pointer; }
        .media-item:hover { transform: scale(1.05); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); }
        .modal { background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px); }
        .modal-content { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.3); }
        .form-input { background: rgba(250, 247, 240, 0.8); border: 2px solid transparent; transition: all 0.3s ease; }
        .form-input:focus { background: rgba(255, 255, 255, 0.9); border-color: #E17055; box-shadow: 0 0 0 4px rgba(225, 112, 85, 0.1); }
        .form-input[readonly] { background: rgba(240, 240, 240, 0.5); cursor: not-allowed; }
        .back-btn { background: rgba(52, 152, 219, 0.1); color: #3498db; border: 1px solid rgba(52, 152, 219, 0.2); transition: all 0.3s ease; }
        .back-btn:hover { background: #3498db; color: white; }
        .logout-btn { background: rgba(231, 76, 60, 0.1); color: #e74c3c; border: 1px solid rgba(231, 76, 60, 0.2); transition: all 0.3s ease; }
        .logout-btn:hover { background: #e74c3c; color: white; }
        .edit-btn { background: rgba(46, 204, 113, 0.1); color: #2ecc71; border: 1px solid rgba(46, 204, 113, 0.2); transition: all 0.3s ease; }
        .save-btn { background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); color: white; }
        .save-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(46, 204, 113, 0.3); }
        .floating-shapes { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .shape { position: absolute; opacity: 0.1; animation: float 8s ease-in-out infinite; }
        .shape:nth-child(1) { top: 20%; left: 10%; animation-delay: 0s; }
        .shape:nth-child(2) { top: 60%; right: 15%; animation-delay: 3s; }
        .shape:nth-child(3) { bottom: 20%; left: 20%; animation-delay: 6s; }
        @keyframes float { 0%, 100% { transform: translateY(0px) rotate(0deg); } 50% { transform: translateY(-30px) rotate(180deg); } }
        
        /* Notification Toast Styles */
        .notification {
            position: fixed;
            top: 5rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-left: 4px solid;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            max-width: 20rem;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 1.7s forwards;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .notification.info { border-color: #3498db; }
        .notification.success { border-color: #2ecc71; }
        .notification.warning { border-color: #f39c12; }
        .notification.error { border-color: #e74c3c; }
        .notification-icon { margin-right: 0.75rem; font-size: 1.25rem; }
        .notification-message { color: #2c3e50; font-weight: 500; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar fixed top-0 left-0 right-0 z-50 px-4 py-3">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <button id="backBtn" class="back-btn px-3 py-2 rounded-lg text-sm font-medium">
                    ‚Üê Quay l·∫°i
                </button>
                <div class="text-2xl">üêí</div>
                <h1 class="text-xl font-bold text-gray-800">A5K60</h1>
            </div>
            
            <div class="flex items-center space-x-4">
                <div class="hidden md:block">
                    <span class="text-sm text-gray-600">Trang c√° nh√¢n</span>
                </div>
                <button id="logoutBtn" class="logout-btn px-4 py-2 rounded-lg text-sm font-medium">
                    ƒêƒÉng xu·∫•t
                </button>
            </div>
        </div>
    </nav>
    
    <!-- Notification Toast -->
    <div id="notification" class="notification hidden">
        <div class="flex items-center">
            <div id="notificationIcon" class="notification-icon"></div>
            <div id="notificationMessage" class="notification-message"></div>
        </div>
    </div>
    
    <!-- Main Content -->
    <main class="pt-20 px-4 pb-8">
        <div class="max-w-4xl mx-auto">
            <!-- Profile Header -->
            <section class="profile-header p-8 mb-8 text-center relative">
                <div class="floating-shapes">
                    <div class="shape w-12 h-12 bg-orange-400 rounded-full"></div>
                    <div class="shape w-8 h-8 bg-blue-400 rounded-lg"></div>
                    <div class="shape w-16 h-16 bg-green-400 rounded-full"></div>
                </div>
                
                <div class="relative z-10">
                    <input type="file" id="avatarInput" accept="image/*" class="hidden">
                    <div id="profileAvatar" class="profile-avatar" style="cursor: pointer;">
                        üêµ
                    </div>
                    <h2 id="profileName" class="text-3xl font-bold text-gray-800 mb-2">
                        ƒêang t·∫£i...
                    </h2>
                    <p id="profileBio" class="text-lg text-gray-600 mb-4">
                        Th√†nh vi√™n ƒë·∫∑c bi·ªát c·ªßa nh√≥m
                    </p>
                    <div class="flex justify-center items-center space-x-4 text-sm text-gray-500">
                        <div class="text-center">
                            <div id="memberNumber" class="text-2xl font-bold text-orange-500">01</div>
                            <div>S·ªë hi·ªáu</div>
                        </div>
                        <div class="text-center">
                            <div id="joinDate" class="text-2xl font-bold text-blue-500">2024</div>
                            <div>Ng√†y tham gia</div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Content Sections -->
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Avatar & Profile Info Edit -->
                <section class="content-section p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-800">üé≠ Th√¥ng tin c√° nh√¢n</h3>
                        <button id="toggleEditBtn" class="edit-btn px-4 py-2 rounded-lg text-sm font-medium">
                            Ch·ªânh s·ª≠a
                        </button>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="text-center">
                            <div id="currentAvatar" class="w-24 h-24 bg-gradient-to-r from-orange-400 to-red-500 rounded-full flex items-center justify-center text-white text-3xl mx-auto mb-4">
                                üêµ
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">T√™n hi·ªÉn th·ªã</label>
                                <input type="text" id="displayName" class="form-input w-full px-4 py-3 rounded-xl focus:outline-none" readonly>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Bio</label>
                                <textarea id="bioInput" class="form-input w-full px-4 py-3 rounded-xl focus:outline-none resize-none" rows="3" readonly></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div id="profileActions" class="flex justify-end space-x-3 mt-6 hidden">
                        <button id="saveProfileBtn" class="save-btn px-4 py-2 rounded-lg text-sm font-medium">
                            üíæ L∆∞u thay ƒë·ªïi
                        </button>
                    </div>
                </section>
                
                <!-- Personal Media Gallery -->
                <section class="content-section p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-800">üì∏ Th∆∞ vi·ªán c√° nh√¢n</h3>
                        <button id="uploadBtn" class="upload-btn px-4 py-2 text-white rounded-lg text-sm font-medium">
                            + Upload
                        </button>
                    </div>
                    
                    <div id="mediaGallery" class="splide">
                        <div class="splide__track">
                            <ul id="mediaSlides" class="splide__list">
                                <!-- Media items will be populated by JavaScript -->
                            </ul>
                        </div>
                    </div>
                    
                    <div id="noMedia" class="text-center py-8 hidden">
                        <div class="text-4xl mb-2">üì∑</div>
                        <p class="text-gray-500">Ch∆∞a c√≥ ·∫£nh n√†o</p>
                        <p class="text-sm text-gray-400">H√£y upload ·∫£nh ƒë·∫ßu ti√™n c·ªßa b·∫°n!</p>
                    </div>
                </section>
                
                <!-- Group Media Gallery -->
                <section class="content-section p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-800">üë• ·∫¢nh/Video nh√≥m chung</h3>
                        <button id="uploadGroupBtn" class="upload-btn px-4 py-2 text-white rounded-lg text-sm font-medium">
                            + Chia s·∫ª
                        </button>
                    </div>
                    
                    <div id="groupMediaGallery" class="splide">
                        <div class="splide__track">
                            <ul id="groupMediaSlides" class="splide__list">
                                <!-- Group media items will be populated -->
                            </ul>
                        </div>
                    </div>
                    
                    <div id="noGroupMedia" class="text-center py-8">
                        <div class="text-4xl mb-2">üë•</div>
                        <p class="text-gray-500">Ch∆∞a c√≥ media nh√≥m</p>
                        <p class="text-sm text-gray-400">H√£y chia s·∫ª ·∫£nh/video ƒë·∫ßu ti√™n!</p>
                    </div>
                </section>
                
                <!-- Social Links & Groups -->
                <section class="content-section p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-800">üîó Li√™n k·∫øt & Nh√≥m</h3>
                        <button id="editLinksBtn" class="edit-btn px-3 py-2 rounded-lg text-sm font-medium">
                            S·ª≠a links
                        </button>
                    </div>
                    
                    <!-- Social Links -->
                    <div class="space-y-4 mb-6">
                        <div class="social-link p-4 rounded-xl">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center text-white font-bold">f</div>
                                <div class="flex-1">
                                    <div class="font-medium text-gray-800">Facebook</div>
                                    <div id="facebookLink" class="text-sm text-gray-500 truncate">Ch∆∞a c·∫≠p nh·∫≠t</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="social-link p-4 rounded-xl">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-pink-500 rounded-lg flex items-center justify-center text-white font-bold">üì∑</div>
                                <div class="flex-1">
                                    <div class="font-medium text-gray-800">Instagram</div>
                                    <div id="instagramLink" class="text-sm text-gray-500 truncate">Ch∆∞a c·∫≠p nh·∫≠t</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="social-link p-4 rounded-xl">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center text-white font-bold">üîí</div>
                                <div class="flex-1">
                                    <div class="font-medium text-gray-800">Locket</div>
                                    <div id="locketLink" class="text-sm text-gray-500 truncate">Ch∆∞a c·∫≠p nh·∫≠t</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Hobbies Section -->
                <section class="content-section p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-800">‚ù§Ô∏è S·ªü th√≠ch</h3>
                        <button id="editHobbiesBtn" class="edit-btn px-3 py-2 rounded-lg text-sm font-medium">
                            S·ª≠a s·ªü th√≠ch
                        </button>
                    </div>
                    
                    <div id="hobbiesContainer" class="flex flex-wrap gap-2">
                        <!-- Hobbies rendered by JavaScript -->
                    </div>
                    
                    <div id="hobbiesEditSection" class="hidden mt-4">
                        <input type="text" id="newHobbyInput" placeholder="Nh·∫≠p s·ªü th√≠ch m·ªõi..." class="form-input w-full px-4 py-3 rounded-xl mb-3">
                        <div class="flex space-x-2">
                            <button id="addHobbyBtn" class="upload-btn px-4 py-2 text-white rounded-lg text-sm">+ Th√™m</button>
                            <button id="saveHobbiesBtn" class="save-btn px-4 py-2 rounded-lg text-sm font-medium">L∆∞u</button>
                        </div>
                    </div>
                </section>
                
                <!-- Personal Info -->
                <section class="content-section p-6 mt-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">‚ÑπÔ∏è Th√¥ng tin c√° nh√¢n</h3>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-3">Gi·ªõi thi·ªáu</h4>
                            <p id="personalInfo" class="text-gray-600 leading-relaxed">
                                Th√†nh vi√™n tuy·ªát v·ªùi c·ªßa nh√≥m A5K60. Lu√¥n mang ƒë·∫øn nƒÉng l∆∞·ª£ng t√≠ch c·ª±c v√† ni·ªÅm vui cho m·ªçi ng∆∞·ªùi xung quanh.
                            </p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-3">C√¢u n√≥i y√™u th√≠ch</h4>
                            <p id="favoriteQuote" class="text-gray-600 italic">
                                "Life is what happens when you're busy making other plans."
                            </p>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <button id="editQuoteBtn" class="edit-btn px-4 py-2 rounded-lg text-sm font-medium">
                            S·ª≠a c√¢u n√≥i y√™u th√≠ch
                        </button>
                        <div id="quoteEditSection" class="hidden mt-4">
                            <textarea id="quoteInput" rows="3" class="form-input w-full px-4 py-3 rounded-xl" placeholder="Nh·∫≠p c√¢u n√≥i y√™u th√≠ch..."></textarea>
                            <button id="saveQuoteBtn" class="save-btn mt-3 px-4 py-2 rounded-lg text-sm font-medium">L∆∞u</button>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>
    
    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="modal fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="modal-content rounded-2xl p-8 w-full max-w-md">
            <div class="text-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-2">Ch·ªânh s·ª≠a th√¥ng tin</h3>
                <p class="text-gray-600">C·∫≠p nh·∫≠t th√¥ng tin c√° nh√¢n c·ªßa b·∫°n</p>
            </div>
            
            <form id="editProfileForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">T√™n hi·ªÉn th·ªã</label>
                    <input type="text" id="editDisplayName" class="form-input w-full px-4 py-3 rounded-xl focus:outline-none" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Bio</label>
                    <textarea id="editBio" class="form-input w-full px-4 py-3 rounded-xl focus:outline-none resize-none" rows="3"></textarea>
                </div>
                
                <div class="flex space-x-3">
                    <button type="button" id="cancelEditProfile" class="flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-xl font-medium hover:bg-gray-300 transition-all">
                        H·ªßy
                    </button>
                    <button type="submit" class="flex-1 save-btn px-4 py-3 rounded-xl font-medium">
                        üíæ L∆∞u
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Upload Modal -->
    <div id="uploadModal" class="modal fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="modal-content rounded-2xl p-8 w-full max-w-md">
            <div class="text-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-2">Upload ·∫£nh/video</h3>
                <p class="text-gray-600">Ch·ªçn file ƒë·ªÉ upload</p>
            </div>
            
            <form id="uploadForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ch·ªçn file</label>
                    <input type="file" id="fileInput" accept="image/*,video/*" class="form-input w-full px-4 py-3 rounded-xl focus:outline-none" multiple>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">M√¥ t·∫£</label>
                    <textarea id="fileDescription" placeholder="M√¥ t·∫£ v·ªÅ file n√†y..." class="form-input w-full px-4 py-3 rounded-xl focus:outline-none resize-none" rows="3"></textarea>
                </div>
                
                <div class="flex space-x-3">
                    <button type="button" id="cancelUpload" class="flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-xl font-medium hover:bg-gray-300 transition-all">
                        H·ªßy
                    </button>
                    <button type="submit" class="flex-1 upload-btn px-4 py-3 text-white rounded-xl font-medium">
                        Upload
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Edit Links Modal -->
    <div id="editLinksModal" class="modal fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="modal-content rounded-2xl p-8 w-full max-w-md">
            <div class="text-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-2">C·∫≠p nh·∫≠t li√™n k·∫øt</h3>
                <p class="text-gray-600">Nh·∫≠p c√°c li√™n k·∫øt m·∫°ng x√£ h·ªôi</p>
            </div>
            
            <form id="editLinksForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Facebook</label>
                    <input type="url" id="facebookInput" placeholder="https://facebook.com/yourprofile" class="form-input w-full px-4 py-3 rounded-xl focus:outline-none">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Instagram</label>
                    <input type="url" id="instagramInput" placeholder="https://instagram.com/yourprofile" class="form-input w-full px-4 py-3 rounded-xl focus:outline-none">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Locket</label>
                    <input type="url" id="locketInput" placeholder="https://locket.com/yourprofile" class="form-input w-full px-4 py-3 rounded-xl focus:outline-none">
                </div>
                
                <div class="flex space-x-3">
                    <button type="button" id="cancelEditLinks" class="flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-xl font-medium hover:bg-gray-300 transition-all">
                        H·ªßy
                    </button>
                    <button type="submit" class="flex-1 save-btn px-4 py-3 rounded-xl font-medium">
                        üíæ L∆∞u
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyAbD9ave4WUPk9MndVZ7_3_f5XyhNVepEY",
            authDomain: "a5k60-website.firebaseapp.com",
            databaseURL: "https://a5k60-website-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "a5k60-website",
            storageBucket: "a5k60-website.firebasestorage.app",
            messagingSenderId: "1083754554024",
            appId: "1:1083754554024:web:6847ea23b19a9369dc989d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        // D·ªØ li·ªáu th√†nh vi√™n
        let memberData = {
            id: '01',
            name: 'Th√†nh vi√™n A5K60',
            avatar: 'üêµ',
            bio: 'Th√†nh vi√™n ƒë·∫∑c bi·ªát c·ªßa nh√≥m',
            joinDate: '2024-01-15',
            personalInfo: 'Th√†nh vi√™n tuy·ªát v·ªùi c·ªßa nh√≥m A5K60. Lu√¥n mang ƒë·∫øn nƒÉng l∆∞·ª£ng t√≠ch c·ª±c v√† ni·ªÅm vui cho m·ªçi ng∆∞·ªùi xung quanh.',
            hobbies: ['√Çm nh·∫°c', 'Du l·ªãch', 'Nhi·∫øp ·∫£nh'],
            favoriteQuote: '"Life is what happens when you\'re busy making other plans."',
            socialLinks: { facebook: '', instagram: '', locket: '' },
            media: []
        };
        
        let splide, groupSplide;
        let isEditMode = false;
        
        // H√†m hi·ªÉn th·ªã th√¥ng b√°o
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const notificationIcon = document.getElementById('notificationIcon');
            const notificationMessage = document.getElementById('notificationMessage');
            
            const icons = { info: '‚ÑπÔ∏è', success: '‚úÖ', warning: '‚ö†Ô∏è', error: '‚ùå' };
            notificationIcon.textContent = icons[type] || icons.info;
            notificationMessage.textContent = message;
            
            notification.className = `notification ${type}`;
            notification.classList.remove('hidden');
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 2000);
        }
        
        // Ki·ªÉm tra ƒëƒÉng nh·∫≠p
        function checkAuth() {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                window.location.href = 'login.html';
                return null;
            }
            return JSON.parse(currentUser);
        }
        
        // T·∫£i d·ªØ li·ªáu t·ª´ Firebase
        async function loadMemberData() {
            const selectedMember = localStorage.getItem('selectedMember');
            const currentUser = checkAuth();
            if (!currentUser) return;
            
            if (!selectedMember) {
                showNotification('Vui l√≤ng ch·ªçn th√†nh vi√™n t·ª´ trang ch·ªß', 'warning');
                window.location.href = 'index.html';
                return;
            }
            
            // Ki·ªÉm tra quy·ªÅn
            if (currentUser.role !== 'admin' && currentUser.memberId !== selectedMember) {
                showNotification('B·∫°n ch·ªâ c√≥ th·ªÉ xem th√¥ng tin c·ªßa ch√≠nh m√¨nh!', 'warning');
                window.location.href = 'index.html';
                return;
            }
            
            memberData.id = selectedMember;
            
            try {
                const snapshot = await db.ref(`users/${selectedMember}`).once('value');
                const data = snapshot.val();
                if (data) {
                    memberData = { 
                        ...memberData, 
                        ...data,
                        // Merge media n·∫øu c√≥
                        media: data.media || [],
                        hobbies: data.hobbies || ['√Çm nh·∫°c', 'Du l·ªãch', 'Nhi·∫øp ·∫£nh']
                    };
                }
                renderProfile();
                renderGroupMedia();
            } catch (error) {
                console.error('L·ªói t·∫£i d·ªØ li·ªáu:', error);
                showNotification('L·ªói t·∫£i d·ªØ li·ªáu: ' + error.message, 'error');
            }
        }
        
        // Hi·ªÉn th·ªã profile
        function renderProfile() {
            document.getElementById('profileName').textContent = memberData.name || `Th√†nh vi√™n ${memberData.id}`;
            document.getElementById('profileBio').textContent = memberData.bio || 'Th√†nh vi√™n A5K60';
            document.getElementById('personalInfo').textContent = memberData.personalInfo;
            document.getElementById('favoriteQuote').textContent = memberData.favoriteQuote;
            document.getElementById('memberNumber').textContent = memberData.id;
            document.getElementById('joinDate').textContent = memberData.joinDate.split('-')[0];
            
            // C·∫≠p nh·∫≠t form
            document.getElementById('displayName').value = memberData.name;
            document.getElementById('bioInput').value = memberData.bio;
            
            // Avatar
            document.getElementById('currentAvatar').textContent = memberData.avatar;
            document.getElementById('profileAvatar').textContent = memberData.avatar;
            
            // Social links
            document.getElementById('facebookLink').textContent = memberData.socialLinks.facebook || 'Ch∆∞a c·∫≠p nh·∫≠t';
            document.getElementById('instagramLink').textContent = memberData.socialLinks.instagram || 'Ch∆∞a c·∫≠p nh·∫≠t';
            document.getElementById('locketLink').textContent = memberData.socialLinks.locket || 'Ch∆∞a c·∫≠p nh·∫≠t';
            
            // Hobbies
            renderHobbies();
            
            // Media
            renderMediaGallery();
        }
        
        // Hi·ªÉn th·ªã s·ªü th√≠ch v·ªõi n√∫t x√≥a
        function renderHobbies() {
            const container = document.getElementById('hobbiesContainer');
            const currentUser = checkAuth();
            const canEdit = currentUser && (currentUser.role === 'admin' || currentUser.memberId === memberData.id);
            
            container.innerHTML = memberData.hobbies.map((hobby, index) => 
                `<span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm inline-flex items-center gap-2">
                    ${hobby}
                    ${canEdit ? `<button onclick="removeHobby(${index})" class="ml-1 text-red-500 hover:text-red-700 font-bold cursor-pointer">√ó</button>` : ''}
                </span>`
            ).join('');
        }
        
        // X√≥a s·ªü th√≠ch
        function removeHobby(index) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·ªü th√≠ch n√†y?')) {
                memberData.hobbies.splice(index, 1);
                renderHobbies();
                showNotification('‚úÖ ƒê√£ x√≥a s·ªü th√≠ch!', 'success');
            }
        }
        
        // Hi·ªÉn th·ªã media c√° nh√¢n
        function renderMediaGallery() {
            const slides = document.getElementById('mediaSlides');
            const noMedia = document.getElementById('noMedia');
            
            if (!memberData.media || memberData.media.length === 0) {
                document.getElementById('mediaGallery').style.display = 'none';
                noMedia.classList.remove('hidden');
                return;
            }
            
            document.getElementById('mediaGallery').style.display = 'block';
            noMedia.classList.add('hidden');
            
            slides.innerHTML = memberData.media.map(item => `
                <li class="splide__slide">
                    <div class="media-item">
                        ${item.type === 'image' ? 
                            `<img src="${item.url}" alt="${item.description}" class="w-full h-48 object-cover">` :
                            `<video src="${item.url}" controls class="w-full h-48 object-cover"></video>`}
                        <div class="p-4">
                            <p class="text-sm text-gray-600">${item.description}</p>
                        </div>
                    </div>
                </li>
            `).join('');
            
            // Kh·ªüi t·∫°o Splide
            if (splide) splide.destroy();
            splide = new Splide('#mediaGallery', {
                type: 'loop',
                perPage: 1,
                autoplay: true,
                arrows: memberData.media.length > 1,
                pagination: memberData.media.length > 1
            });
            splide.mount();
        }
        
        // Hi·ªÉn th·ªã media nh√≥m chung
        async function renderGroupMedia() {
            const slides = document.getElementById('groupMediaSlides');
            const noMedia = document.getElementById('noGroupMedia');
            const gallery = document.getElementById('groupMediaGallery');
            
            try {
                const snapshot = await db.ref('groupMedia').once('value');
                const groupMedia = snapshot.val();
                
                if (!groupMedia || Object.keys(groupMedia).length === 0) {
                    gallery.style.display = 'none';
                    noMedia.classList.remove('hidden');
                    return;
                }
                
                gallery.style.display = 'block';
                noMedia.classList.add('hidden');
                
                slides.innerHTML = Object.entries(groupMedia).map(([id, item]) => `
                    <li class="splide__slide">
                        <div class="media-item">
                            ${item.type === 'image' ? 
                                `<img src="${item.url}" alt="${item.description}" class="w-full h-48 object-cover">` :
                                `<video src="${item.url}" controls class="w-full h-48 object-cover"></video>`}
                            <div class="p-4">
                                <p class="text-sm text-gray-600">${item.description}</p>
                                <p class="text-xs text-gray-400 mt-1">ƒêƒÉng b·ªüi: ${item.uploaderName || '·∫®n danh'}</p>
                            </div>
                        </div>
                    </li>
                `).join('');
                
                // Kh·ªüi t·∫°o Splide
                if (groupSplide) groupSplide.destroy();
                groupSplide = new Splide('#groupMediaGallery', {
                    type: 'loop',
                    perPage: 1,
                    autoplay: true,
                    arrows: true,
                    pagination: true
                });
                groupSplide.mount();
                
            } catch (error) {
                console.error('L·ªói t·∫£i media nh√≥m:', error);
            }
        }
        
        // Modal
        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
            anime({
                targets: `#${modalId} .modal-content`,
                scale: [0.8, 1],
                opacity: [0, 1],
                duration: 300
            });
        }
        
        function hideModal(modalId) {
            anime({
                targets: `#${modalId} .modal-content`,
                scale: [1, 0.8],
                opacity: [1, 0],
                duration: 200,
                complete: () => document.getElementById(modalId).classList.add('hidden')
            });
        }
        
        // L∆∞u l√™n Firebase
        async function saveToFirebase() {
            try {
                await db.ref(`users/${memberData.id}`).set(memberData);
                showNotification('‚úÖ ƒê√£ l∆∞u v√† ƒë·ªìng b·ªô!', 'success');
            } catch (error) {
                console.error('L·ªói Firebase:', error);
                showNotification('‚ùå L·ªói ƒë·ªìng b·ªô', 'error');
            }
        }
        
        // Event listeners
        function setupEventListeners() {
            // Toggle edit mode
            document.getElementById('toggleEditBtn').addEventListener('click', () => {
                isEditMode = !isEditMode;
                const btn = document.getElementById('toggleEditBtn');
                const inputs = document.querySelectorAll('.form-input');
                const actions = document.getElementById('profileActions');
                
                if (isEditMode) {
                    btn.textContent = 'H·ªßy';
                    btn.className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-300 transition-all';
                    inputs.forEach(input => input.removeAttribute('readonly'));
                    actions.classList.remove('hidden');
                } else {
                    btn.textContent = 'Ch·ªânh s·ª≠a';
                    btn.className = 'edit-btn px-4 py-2 rounded-lg text-sm font-medium';
                    inputs.forEach(input => input.setAttribute('readonly', ''));
                    actions.classList.add('hidden');
                }
            });
            
            // L∆∞u profile
            document.getElementById('saveProfileBtn').addEventListener('click', async () => {
                memberData.name = document.getElementById('displayName').value;
                memberData.bio = document.getElementById('bioInput').value;
                await saveToFirebase();
                renderProfile();
                isEditMode = false;
                document.getElementById('profileActions').classList.add('hidden');
                showNotification('‚úÖ ƒê√£ c·∫≠p nh·∫≠t th√¥ng tin!', 'success');
            });
            
            // Avatar upload - ƒê√É S·ª¨A ƒê·ªÇ L∆ØU V√ÄO FIREBASE
            document.getElementById('profileAvatar').addEventListener('click', () => {
                if (!isEditMode) return;
                document.getElementById('avatarInput').click();
            });
            
            document.getElementById('avatarInput').addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = async (e) => {
                    // L∆∞u avatar v√†o Firebase
                    memberData.avatar = e.target.result;
                    document.getElementById('currentAvatar').innerHTML = `<img src="${e.target.result}" class="w-full h-full rounded-full object-cover">`;
                    document.getElementById('profileAvatar').innerHTML = `<img src="${e.target.result}" class="w-full h-full rounded-full object-cover">`;
                    await saveToFirebase();
                    showNotification('‚úÖ ƒê√£ c·∫≠p nh·∫≠t avatar!', 'success');
                };
                reader.readAsDataURL(file);
            });
            
            // Upload media
            document.getElementById('uploadBtn').addEventListener('click', () => showModal('uploadModal'));
            document.getElementById('cancelUpload').addEventListener('click', () => hideModal('uploadModal'));
            document.getElementById('uploadForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const files = document.getElementById('fileInput').files;
                const description = document.getElementById('fileDescription').value;
                
                for (const file of files) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        memberData.media.push({
                            type: file.type.startsWith('image/') ? 'image' : 'video',
                            url: e.target.result,
                            description: description || file.name
                        });
                    };
                    reader.readAsDataURL(file);
                }
                
                await saveToFirebase();
                renderMediaGallery();
                hideModal('uploadModal');
                document.getElementById('fileInput').value = '';
                document.getElementById('fileDescription').value = '';
            });
            
            // Upload group media
            document.getElementById('uploadGroupBtn').addEventListener('click', async () => {
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = 'image/*,video/*';
                fileInput.multiple = true;
                
                fileInput.onchange = async (e) => {
                    const files = e.target.files;
                    const description = prompt('M√¥ t·∫£ v·ªÅ file n√†y:') || '';
                    
                    for (const file of files) {
                        const reader = new FileReader();
                        reader.onload = async (e) => {
                            const mediaData = {
                                type: file.type.startsWith('image/') ? 'image' : 'video',
                                url: e.target.result,
                                description: description || file.name,
                                uploaderId: memberData.id,
                                uploaderName: memberData.name,
                                uploadTime: Date.now()
                            };
                            
                            // L∆∞u v√†o Firebase
                            const newRef = db.ref('groupMedia').push();
                            await newRef.set(mediaData);
                        };
                        reader.readAsDataURL(file);
                    }
                    
                    showNotification('‚úÖ ƒê√£ upload media nh√≥m!', 'success');
                    setTimeout(renderGroupMedia, 1000);
                };
                
                fileInput.click();
            });
            
            // Edit links
            document.getElementById('editLinksBtn').addEventListener('click', () => {
                document.getElementById('facebookInput').value = memberData.socialLinks.facebook || '';
                document.getElementById('instagramInput').value = memberData.socialLinks.instagram || '';
                document.getElementById('locketInput').value = memberData.socialLinks.locket || '';
                showModal('editLinksModal');
            });
            document.getElementById('cancelEditLinks').addEventListener('click', () => hideModal('editLinksModal'));
            document.getElementById('editLinksForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                memberData.socialLinks = {
                    facebook: document.getElementById('facebookInput').value,
                    instagram: document.getElementById('instagramInput').value,
                    locket: document.getElementById('locketInput').value
                };
                await saveToFirebase();
                renderProfile();
                hideModal('editLinksModal');
                showNotification('‚úÖ ƒê√£ c·∫≠p nh·∫≠t li√™n k·∫øt!', 'success');
            });
            
            // Edit hobbies
            document.getElementById('editHobbiesBtn').addEventListener('click', () => {
                const section = document.getElementById('hobbiesEditSection');
                section.classList.toggle('hidden');
            });
            
            document.getElementById('addHobbyBtn').addEventListener('click', () => {
                const input = document.getElementById('newHobbyInput');
                const hobby = input.value.trim();
                if (hobby) {
                    memberData.hobbies.push(hobby);
                    renderHobbies();
                    input.value = '';
                    showNotification('‚úÖ ƒê√£ th√™m s·ªü th√≠ch!', 'success');
                }
            });
            
            document.getElementById('saveHobbiesBtn').addEventListener('click', async () => {
                await saveToFirebase();
                document.getElementById('hobbiesEditSection').classList.add('hidden');
                showNotification('‚úÖ ƒê√£ l∆∞u s·ªü th√≠ch!', 'success');
            });
            
            // Edit quote
            document.getElementById('editQuoteBtn').addEventListener('click', () => {
                const section = document.getElementById('quoteEditSection');
                document.getElementById('quoteInput').value = memberData.favoriteQuote;
                section.classList.toggle('hidden');
            });
            
            document.getElementById('saveQuoteBtn').addEventListener('click', async () => {
                memberData.favoriteQuote = document.getElementById('quoteInput').value;
                await saveToFirebase();
                renderProfile();
                document.getElementById('quoteEditSection').classList.add('hidden');
                showNotification('‚úÖ ƒê√£ l∆∞u c√¢u n√≥i y√™u th√≠ch!', 'success');
            });
            
            // Navigation
            document.getElementById('backBtn').addEventListener('click', () => {
                window.location.href = 'index.html';
            });
            
            document.getElementById('logoutBtn').addEventListener('click', () => {
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            });
        }
        
        // Kh·ªüi t·∫°o
        document.addEventListener('DOMContentLoaded', async () => {
            await loadMemberData();
            setupEventListeners();
            
            // L·∫Øng nghe realtime cho groupMedia
            db.ref('groupMedia').on('child_added', () => renderGroupMedia());
            db.ref('groupMedia').on('child_removed', () => renderGroupMedia());
            
            anime({
                targets: '.content-section',
                translateY: [50, 0],
                opacity: [0, 1],
                duration: 800,
                delay: anime.stagger(200)
            });
        });
    </script>
</body>
</html>
