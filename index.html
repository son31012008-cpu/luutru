<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nh·ªØng con kh·ªâ A5K60 - Trang ch·ªß</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * { font-family: 'Inter', 'Poppins', sans-serif; }
        body { background: linear-gradient(135deg, #FAF7F0 0%, #F0EDE6 100%); min-height: 100vh; }
        .navbar { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255, 255, 255, 0.2); }
        .member-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 1.5rem; transition: all 0.3s ease; cursor: pointer; }
        .member-card:hover { background: rgba(255, 255, 255, 0.95); transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15); }
        .search-input { background: rgba(255, 255, 255, 0.9); border: 2px solid transparent; transition: all 0.3s ease; }
        .search-input:focus { background: rgba(255, 255, 255, 1); border-color: #E17055; box-shadow: 0 0 0 4px rgba(225, 112, 85, 0.1); }
        .filter-btn { background: rgba(255, 255, 255, 0.8); border: 2px solid transparent; transition: all 0.3s ease; }
        .filter-btn.active { background: #E17055; color: white; border-color: #E17055; }
        .hero-section { background: linear-gradient(135deg, rgba(225, 112, 85, 0.1) 0%, rgba(116, 185, 255, 0.1) 100%); border-radius: 2rem; }
        .floating-element { animation: float 6s ease-in-out infinite; }
        .floating-element:nth-child(2) { animation-delay: 2s; }
        .floating-element:nth-child(3) { animation-delay: 4s; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-20px); } }
        .member-avatar { width: 80px; height: 80px; background: linear-gradient(135deg, #E17055 0%, #D63031 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: white; margin: 0 auto 1rem; border: 4px solid white; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); }
        .member-number { position: absolute; top: 1rem; right: 1rem; background: #E17055; color: white; width: 2rem; height: 2rem; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.875rem; }
        .logout-btn { background: rgba(231, 76, 60, 0.1); color: #e74c3c; border: 1px solid rgba(231, 76, 60, 0.2); transition: all 0.3s ease; }
        .logout-btn:hover { background: #e74c3c; color: white; }
        /* Th√™m style cho loading */
        .loading { display: flex; justify-content: center; align-items: center; height: 200px; }
        .loading::after { content: "ƒêang t·∫£i..."; color: #E17055; font-weight: bold; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar fixed top-0 left-0 right-0 z-50 px-4 py-3">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="text-2xl">üêí</div>
                <h1 class="text-xl font-bold text-gray-800">A5K60</h1>
            </div>
            
            <div class="flex items-center space-x-4">
                <div class="hidden md:block">
                    <span class="text-sm text-gray-600">Xin ch√†o, </span>
                    <span id="userGreeting" class="text-sm font-semibold text-gray-800"></span>
                </div>
                <button id="logoutBtn" class="logout-btn px-4 py-2 rounded-lg text-sm font-medium">
                    ƒêƒÉng xu·∫•t
                </button>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="pt-20 px-4 pb-8">
        <div class="max-w-7xl mx-auto">
            <!-- Hero Section -->
            <section class="hero-section p-8 mb-8 text-center">
                <div class="floating-element inline-block text-6xl mb-4">üêí</div>
                <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">
                    Nh·ªØng con kh·ªâ A5K60
                </h2>
                <p class="text-lg text-gray-600 mb-6">
                    C·ªông ƒë·ªìng 46 th√†nh vi√™n ƒë·∫∑c bi·ªát - N∆°i k·∫øt n·ªëi v√† chia s·∫ª
                </p>
                <div class="flex justify-center items-center space-x-8 text-sm text-gray-500">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-orange-500">46</div>
                        <div>Th√†nh vi√™n</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-500">‚àû</div>
                        <div>K·ª∑ ni·ªám</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-500">‚ô•</div>
                        <div>T√¨nh b·∫°n</div>
                    </div>
                </div>
            </section>
            
            <!-- Debug Info -->
            <div id="debugInfo" class="mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-sm text-yellow-800 hidden">
                <strong>Debug:</strong> <span id="debugMessage"></span>
            </div>
            
            <!-- Search and Filter -->
            <div class="mb-8">
                <div class="flex flex-col md:flex-row gap-4 items-center justify-between">
                    <div class="relative flex-1 max-w-md">
                        <input 
                            type="text" 
                            id="searchInput"
                            placeholder="T√¨m ki·∫øm th√†nh vi√™n..."
                            class="search-input w-full px-4 py-3 pl-12 rounded-xl focus:outline-none"
                        >
                        <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                            üîç
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                        <button class="filter-btn active px-4 py-2 rounded-lg text-sm font-medium" data-filter="all">
                            T·∫•t c·∫£
                        </button>
                        <button class="filter-btn px-4 py-2 rounded-lg text-sm font-medium" data-filter="01-15">
                            01-15
                        </button>
                        <button class="filter-btn px-4 py-2 rounded-lg text-sm font-medium" data-filter="16-30">
                            16-30
                        </button>
                        <button class="filter-btn px-4 py-2 rounded-lg text-sm font-medium" data-filter="31-46">
                            31-46
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Loading State -->
            <div id="loadingState" class="loading"></div>
            
            <!-- Members Grid -->
            <div id="membersGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 md:gap-6 hidden">
                <!-- Members will be populated by Firebase -->
            </div>
            
            <!-- No Results -->
            <div id="noResults" class="hidden text-center py-12">
                <div class="text-6xl mb-4">üîç</div>
                <h3 class="text-xl font-semibold text-gray-600 mb-2">Kh√¥ng t√¨m th·∫•y th√†nh vi√™n</h3>
                <p class="text-sm text-gray-500">Vui l√≤ng th·ª≠ l·∫°i v·ªõi t·ª´ kh√≥a kh√°c</p>
            </div>
        </div>
    </main>
    
    <script>
        // Danh s√°ch 46 th√†nh vi√™n ch√≠nh x√°c
        const memberNames = [
            "V√µ ƒêƒÉng Ho√†ng Anh", "V√µ Ho√†ng Anh", "ƒêinh Vi·∫øt D≈©ng", "L√™ Th·ªã Th√πy D∆∞∆°ng", "Nguy·ªÖn H√†n Giang",
            "Nguy·ªÖn Th·ªã Di·ªÖm H·∫±ng", "Nguy·ªÖn Th·ªã Th√∫y H·∫±ng", "Nguy·ªÖn B·∫£o Ho√†ng", "Nguy·ªÖn VƒÉn Qu·ªëc H·ªôi", "Hu·ª≥nh Gia Huy",
            "Tr·∫ßn Huy Ho√†ng", "H·ªì C√¥ng H∆∞ng", "Nguy·ªÖn Anh Kha", "L√™ Quang Khoa", "Nguy·ªÖn Anh Kh√¥i",
            "Mai ƒêƒÉng Linh", "Nguy·ªÖn Ho√†i Ph∆∞∆°ng Linh", "Nguy·ªÖn Th·ªã Kh√°nh Linh", "Nguy·ªÖn Th·∫£o Ly", "Nguy·ªÖn Ng·ªçc Huy Minh",
            "V√µ Kh√°nh Minh", "L√™ Th·ªã Tr√† My", "Nguy·ªÖn Di·ªÖm My", "V√µ Tr·∫ßn Th·ª•c Nghi", "L√™ H·ªØu Nghƒ©a",
            "Nguy·ªÖn B√≠ch Ng·ªçc", "Tr·∫ßn Th·ªã Thanh Ng·ªçc", "Nguy·ªÖn ƒêƒÉng Nguy√™n", "Nguy·ªÖn Xu√¢n Ho√†ng Nguy√™n", "Ph·∫°m Ho√†ng Th·∫£o Nguy√™n",
            "L√™ Minh Nh·∫≠t", "Nguy·ªÖn Th·ªã Qu·ª≥nh Nh∆∞", "ƒê·∫∑ng Th√†nh Ph√°t", "L√™ Ng·ªçc Quang", "Tr∆∞∆°ng Nh·∫≠t S∆°n",
            "Nguy·ªÖn Th√°i S∆°n", "V≈© Minh S∆°n", "Nguy·ªÖn Quang Thanh", "Tr·∫ßn H∆∞∆°ng Tr√†", "Nguy·ªÖn Ng·ªçc Th·∫£o Trang",
            "Tr·∫ßn Ng·ªçc Huy·ªÅn Tr√¢n", "L√™ Nguy·ªÖn Kh√°nh Tri·ªÅu", "L√™ Ng·ªçc Thanh Tr√∫c", "L√™ V√µ Anh Tu·∫•n", "L√™ Thanh Tuy·∫øn",
            "Nguy·ªÖn H√† Vy"
        ];

        // Debug function
        function showDebug(message) {
            console.log('DEBUG:', message);
            const debugEl = document.getElementById('debugInfo');
            const debugMsg = document.getElementById('debugMessage');
            debugMsg.textContent = message;
            debugEl.classList.remove('hidden');
        }

        // T·∫°o th·∫ª th√†nh vi√™n
        function createMemberCard(memberId, userData) {
            const card = document.createElement('div');
            card.className = 'member-card rounded-2xl p-4 relative';
            card.setAttribute('data-member-id', memberId);
            
            const defaultName = memberNames[parseInt(memberId) - 1];
            const name = userData?.name || defaultName;
            const avatar = userData?.avatar || generateAvatar(memberId);
            
            card.innerHTML = `
                <div class="member-number">${memberId}</div>
                <div class="member-avatar">${avatar}</div>
                <h3 class="font-semibold text-gray-800 text-center mb-1">${name}</h3>
                <p class="text-xs text-gray-500 text-center mb-3">Th√†nh vi√™n A5K60</p>
                <div class="flex justify-center">
                    <span class="inline-block bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs">
                        Tham gia: 2024
                    </span>
                </div>
            `;
            
            card.addEventListener('click', () => {
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                if (!currentUser) {
                    window.location.href = 'login.html';
                    return;
                }
                
                // Ki·ªÉm tra quy·ªÅn truy c·∫≠p: ch·ªâ admin ho·∫∑c ch√≠nh ch·ªß
                if (currentUser.role !== 'admin' && currentUser.memberId !== memberId) {
                    alert('B·∫°n ch·ªâ c√≥ th·ªÉ xem trang c√° nh√¢n c·ªßa ch√≠nh m√¨nh!');
                    return;
                }
                
                localStorage.setItem('selectedMember', memberId);
                window.location.href = 'profile.html';
            });
            
            return card;
        }
        
        function generateAvatar(id) {
            const emojis = ['üêµ', 'üôà', 'üôâ', 'üôä', 'ü¶ç', 'üêí'];
            return emojis[parseInt(id) % 6];
        }
        
        // Firebase config c·ªßa b·∫°n
        const firebaseConfig = {
            apiKey: "AIzaSyAbD9ave4WUPk9MndVZ7_3_f5XyhNVepEY",
            authDomain: "a5k60-website.firebaseapp.com",
            databaseURL: "https://a5k60-website-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "a5k60-website",
            storageBucket: "a5k60-website.firebasestorage.app",
            messagingSenderId: "1083754554024",
            appId: "1:1083754554024:web:6847ea23b19a9369dc989d"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        // Ki·ªÉm tra ƒëƒÉng nh·∫≠p
        function checkAuth() {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                window.location.href = 'login.html';
                return null;
            }
            return JSON.parse(currentUser);
        }
        
        // Render th√†nh vi√™n t·ª´ Firebase
        async function renderMembersFromFirebase() {
            const grid = document.getElementById('membersGrid');
            const loading = document.getElementById('loadingState');
            const noResults = document.getElementById('noResults');
            
            try {
                console.log('B·∫Øt ƒë·∫ßu t·∫£i d·ªØ li·ªáu t·ª´ Firebase...');
                showDebug('ƒêang k·∫øt n·ªëi Firebase...');
                
                const snapshot = await db.ref('users').once('value');
                const users = snapshot.val();
                
                console.log('D·ªØ li·ªáu t·ª´ Firebase:', users);
                showDebug('ƒê√£ nh·∫≠n d·ªØ li·ªáu: ' + (users ? Object.keys(users).length + ' users' : 'NULL'));
                
                if (!users) {
                    throw new Error('Kh√¥ng t√¨m th·∫•y collection "users" trong Firebase');
                }
                
                loading.classList.add('hidden');
                
                // Render ch·ªâ c√°c member 01-46, b·ªè qua admin
                const userIds = Object.keys(users).filter(id => id !== 'admin').sort((a, b) => parseInt(a) - parseInt(b));
                
                console.log('Member IDs ƒë·ªÉ render:', userIds);
                showDebug('Rendering ' + userIds.length + ' th√†nh vi√™n...');
                
                grid.innerHTML = '';
                
                userIds.forEach(memberId => {
                    const userData = users[memberId];
                    const card = createMemberCard(memberId, userData);
                    grid.appendChild(card);
                });
                
                grid.classList.remove('hidden');
                noResults.classList.add('hidden');
                
                showDebug('Ho√†n th√†nh render!');
                
            } catch (error) {
                console.error('L·ªói khi t·∫£i d·ªØ li·ªáu:', error);
                showDebug('L·ªñI: ' + error.message);
                loading.classList.add('hidden');
                noResults.classList.remove('hidden');
                document.getElementById('noResults').querySelector('p').textContent = 'L·ªói: ' + error.message;
            }
        }
        
        // L·∫Øng nghe thay ƒë·ªïi real-time
        function setupRealtimeListener() {
            db.ref('users').on('child_changed', snapshot => {
                const memberId = snapshot.key;
                const data = snapshot.val();
                
                // B·ªè qua admin
                if (memberId === 'admin') return;
                
                const card = document.querySelector(`[data-member-id="${memberId}"]`);
                
                if (card) {
                    const nameEl = card.querySelector('h3');
                    const avatarEl = card.querySelector('.member-avatar');
                    
                    nameEl.textContent = data.name || memberNames[parseInt(memberId) - 1];
                    avatarEl.textContent = data.avatar || generateAvatar(memberId);
                    
                    // Hi·ªáu ·ª©ng khi ƒë∆∞·ª£c c·∫≠p nh·∫≠t
                    anime({
                        targets: card,
                        scale: [1, 1.05, 1],
                        duration: 500
                    });
                }
            });
        }
        
        // T√¨m ki·∫øm
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                const cards = document.querySelectorAll('.member-card');
                let hasResults = false;
                
                cards.forEach(card => {
                    const name = card.querySelector('h3').textContent.toLowerCase();
                    const id = card.getAttribute('data-member-id');
                    if (name.includes(query) || id.includes(query)) {
                        card.style.display = 'block';
                        hasResults = true;
                    } else {
                        card.style.display = 'none';
                    }
                });
                
                document.getElementById('noResults').classList.toggle('hidden', hasResults || query === '');
            });
        }
        
        // L·ªçc
        function setupFilter() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const filter = this.dataset.filter;
                    const cards = document.querySelectorAll('.member-card');
                    
                    if (filter === 'all') {
                        cards.forEach(card => card.style.display = 'block');
                        return;
                    }
                    
                    const [start, end] = filter.split('-').map(Number);
                    cards.forEach(card => {
                        const id = parseInt(card.getAttribute('data-member-id'));
                        card.style.display = (id >= start && id <= end) ? 'block' : 'none';
                    });
                });
            });
        }
        
        // ƒêƒÉng xu·∫•t
        function setupLogout() {
            document.getElementById('logoutBtn').addEventListener('click', () => {
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            });
        }
        
        // Kh·ªüi t·∫°o khi trang load
        document.addEventListener('DOMContentLoaded', async () => {
            const currentUser = checkAuth();
            if (!currentUser) return;
            
            document.getElementById('userGreeting').textContent = 
                currentUser.role === 'admin' ? 'Admin' : `Member ${currentUser.memberId}`;
            
            // T·∫£i v√† render d·ªØ li·ªáu
            await renderMembersFromFirebase();
            
            setupRealtimeListener();
            setupSearch();
            setupFilter();
            setupLogout();
            
            // Animation
            anime({
                targets: '.member-card',
                translateY: [50, 0],
                opacity: [0, 1],
                duration: 600,
                delay: anime.stagger(100)
            });
        });
    </script>
</body>
</html>
